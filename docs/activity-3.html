<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 5 Activity 3 | Portfolio Stat 764</title>
<meta name="author" content="Gabriel Hintz">
<meta name="description" content='5.1 Upload data # Upload data url &lt;- "https://www.dropbox.com/scl/fi/9ymxt900s77uq50ca6dgc/Enders-et-al.-2018-data.csv?rlkey=0rxjwleenhgu0gvzow5p0x9xf&amp;dl=1" df &lt;- read.csv(url) df &lt;-...'>
<meta name="generator" content="bookdown 0.39 with bs4_book()">
<meta property="og:title" content="Chapter 5 Activity 3 | Portfolio Stat 764">
<meta property="og:type" content="book">
<meta property="og:description" content='5.1 Upload data # Upload data url &lt;- "https://www.dropbox.com/scl/fi/9ymxt900s77uq50ca6dgc/Enders-et-al.-2018-data.csv?rlkey=0rxjwleenhgu0gvzow5p0x9xf&amp;dl=1" df &lt;- read.csv(url) df &lt;-...'>
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 5 Activity 3 | Portfolio Stat 764">
<meta name="twitter:description" content='5.1 Upload data # Upload data url &lt;- "https://www.dropbox.com/scl/fi/9ymxt900s77uq50ca6dgc/Enders-et-al.-2018-data.csv?rlkey=0rxjwleenhgu0gvzow5p0x9xf&amp;dl=1" df &lt;- read.csv(url) df &lt;-...'>
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.7.0/transition.js"></script><script src="libs/bs3compat-0.7.0/tabs.js"></script><script src="libs/bs3compat-0.7.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.2.1/leaflet.js"></script><script src="libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script><script src="libs/leaflet-providers-plugin-2.2.1/leaflet-providers-plugin.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Portfolio Stat 764</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> About</a></li>
<li><a class="" href="journals.html"><span class="header-section-number">2</span> Journals</a></li>
<li><a class="" href="activity-1.html"><span class="header-section-number">3</span> Activity 1</a></li>
<li><a class="" href="activity-2.html"><span class="header-section-number">4</span> Activity 2</a></li>
<li><a class="active" href="activity-3.html"><span class="header-section-number">5</span> Activity 3</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/rstudio/bookdown-demo">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="activity-3" class="section level1" number="5">
<h1>
<span class="header-section-number">5</span> Activity 3<a class="anchor" aria-label="anchor" href="#activity-3"><i class="fas fa-link"></i></a>
</h1>
<div id="upload-data" class="section level2" number="5.1">
<h2>
<span class="header-section-number">5.1</span> Upload data<a class="anchor" aria-label="anchor" href="#upload-data"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Upload data</span></span>
<span><span class="va">url</span> <span class="op">&lt;-</span> <span class="st">"https://www.dropbox.com/scl/fi/9ymxt900s77uq50ca6dgc/Enders-et-al.-2018-data.csv?rlkey=0rxjwleenhgu0gvzow5p0x9xf&amp;dl=1"</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="va">url</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">8</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">]</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>presence <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">EGA</span> <span class="op">!=</span> <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="co"># Keep only the data on bird cherry-oat aphid</span></span>
<span></span>
<span><span class="co"># Download KS shapefile</span></span>
<span><span class="va">ks</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/getData.html">getData</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"GADM"</span>, country<span class="op">=</span><span class="st">"USA"</span>, level<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">st_as_sf</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">NAME_1</span> <span class="op">==</span> <span class="st">'Kansas'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_sf</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">%&gt;%</span> <span class="fu">st_as_sf</span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'long'</span>, <span class="st">'lat'</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="va">ks</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="upload-covariates" class="section level2" number="5.2">
<h2>
<span class="header-section-number">5.2</span> Upload covariates<a class="anchor" aria-label="anchor" href="#upload-covariates"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">url.nlcd</span> <span class="op">&lt;-</span> <span class="st">"https://www.dropbox.com/scl/fi/ew7yzm93aes7l8l37cn65/KS_2011_NLCD.img?rlkey=60ahyvxhq18gt0yr47tuq5fig&amp;dl=1"</span></span>
<span><span class="va">rl.nlcd2011</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="op">(</span><span class="va">url.nlcd</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">rl.nlcd2011</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="04-Activity_3_files/figure-html/unnamed-chunk-2-1.png" width="672"></div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="co"># Make raster file that contains pixels with value of 1 if grassland and </span></span>
<span><span class="co"># zero if other type of land cover.</span></span>
<span><span class="co"># NLCD legend can be found here: https://www.mrlc.gov/data/legends/national-land-cover-database-2011-nlcd2011-legend</span></span>
<span><span class="va">rl.nlcd.grass</span> <span class="op">&lt;-</span> <span class="va">rl.nlcd2011</span></span>
<span><span class="va">rl.nlcd.grass</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">rl.nlcd.grass</span><span class="op">[</span><span class="op">]</span><span class="op">==</span><span class="fl">71</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">rl.nlcd.grass</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="04-Activity_3_files/figure-html/unnamed-chunk-2-2.png" width="672"></div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">pts.sample</span><span class="op">&lt;-</span> <span class="va">df</span></span>
<span></span>
<span><span class="fu">coordinates</span><span class="op">(</span><span class="va">pts.sample</span><span class="op">)</span> <span class="op">=</span><span class="op">~</span> <span class="va">long</span> <span class="op">+</span> <span class="va">lat</span></span>
<span><span class="fu">proj4string</span><span class="op">(</span><span class="va">pts.sample</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">CRS</span><span class="op">(</span><span class="st">"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate percentage of land area that is grassland within 5 km of sampled location</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">grass.perc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu">extract</span><span class="op">(</span><span class="va">rl.nlcd.grass</span>,<span class="va">pts.sample</span>,buffer<span class="op">=</span><span class="fl">5000</span><span class="op">)</span>,<span class="va">mean</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="fl">100</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">grass.perc</span>,col<span class="op">=</span><span class="st">"grey"</span>,main<span class="op">=</span><span class="st">""</span>,xlab<span class="op">=</span><span class="st">"% grassland within \n5 km at sample location"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="04-Activity_3_files/figure-html/unnamed-chunk-2-3.png" width="672"></div>
</div>
<div id="for-the-data-on-the-abundance-of-english-grain-aphids-propose-three-different-statistical-models-or-machine-learning-approach-that-are-capable-of-predicting-the-number-of-english-grain-aphids-at-any-location-within-the-state-of-kansas-at-any-time-for-the-years-2014-and-2015.-make-sure-to-write-out-the-three-statistical-models-using-formal-notation-and-fully-describe-each-component-using-words." class="section level2" number="5.3">
<h2>
<span class="header-section-number">5.3</span> For the data on the abundance of English grain aphids, propose three different statistical models (or machine learning approach) that are capable of predicting the number of English grain aphids at any location within the state of Kansas at any time for the years 2014 and 2015. Make sure to write out the three statistical models using formal notation and fully describe each component using words.<a class="anchor" aria-label="anchor" href="#for-the-data-on-the-abundance-of-english-grain-aphids-propose-three-different-statistical-models-or-machine-learning-approach-that-are-capable-of-predicting-the-number-of-english-grain-aphids-at-any-location-within-the-state-of-kansas-at-any-time-for-the-years-2014-and-2015.-make-sure-to-write-out-the-three-statistical-models-using-formal-notation-and-fully-describe-each-component-using-words."><i class="fas fa-link"></i></a>
</h2>
<p><em>Model 1</em></p>
<p>Data model <span class="math display">\[Z = y\]</span> Process model Using Poisson distribution</p>
<p><span class="math display">\[[y|\lambda] = Poisson(\lambda) \]</span></p>
<p><span class="math display">\[\eta_s\sim MUN(0, \sigma)\]</span> 
<span class="math display">\[E(y)=e^{\beta_0+\beta_1\cdot X + \eta_s+\eta_t}\]</span></p>
<p><em>Model 2</em></p>
<p>Data model</p>
<p><span class="math display">\[Z = y\]</span> Process model Using Negative binomial distribution</p>
<p><span class="math display">\[[y|r,p] = NB(r, p)\]</span> <span class="math display">\[\eta_s\sim MVN(0, \sigma)\]</span>
<span class="math display">\[E(y)=e^{\beta_0+\beta_1\cdot X + \eta_s+\eta_t}\]</span></p>
<p><em>Model 3</em></p>
<p>Data model</p>
<p><span class="math display">\[Z = y\]</span> Process model Using zero inflated poisson distribution</p>
<p><span class="math display">\[[y|p, \lambda]=ZIP(p,\lambda)\]</span> <span class="math display">\[\eta_s\sim MVN(0, \sigma^2)\]</span>
<span class="math display">\[P(y=0) = p\cdot e^{-0} + (1-p) \cdot e^{-{\lambda}}\]</span>
<span class="math display">\[P(y = k) = (1-p) \cdot \frac{(e^{-{\lambda}}{\lambda^k})}{k!}, k \in N\]</span>
<span class="math display">\[{\lambda} &gt; 0, p \in (0,1)\]</span>
<span class="math display">\[E(y)=e^{\beta_0+\beta_1\cdot X + \eta_s+\eta_t}\]</span></p>
</div>
<div id="for-the-three-statistical-models-you-proposed-in-question-1-propose-a-way-to-measure-the-accuracy-and-perhaps-the-calibration-of-predictions." class="section level2" number="5.4">
<h2>
<span class="header-section-number">5.4</span> For the three statistical models you proposed in question #1, propose a way to measure the accuracy (and perhaps the calibration) of predictions.<a class="anchor" aria-label="anchor" href="#for-the-three-statistical-models-you-proposed-in-question-1-propose-a-way-to-measure-the-accuracy-and-perhaps-the-calibration-of-predictions."><i class="fas fa-link"></i></a>
</h2>
<p>RMSE and MAE and AIC.</p>
</div>
<div id="fit-the-three-statistical-models-you-proposed-in-question-1-to-the-english-grain-aphid-abundance-data." class="section level2" number="5.5">
<h2>
<span class="header-section-number">5.5</span> Fit the three statistical models you proposed in question #1 to the English grain aphid abundance data.<a class="anchor" aria-label="anchor" href="#fit-the-three-statistical-models-you-proposed-in-question-1-to-the-english-grain-aphid-abundance-data."><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">ks</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">df_sf</span>, shape <span class="op">=</span> <span class="fl">21</span>, <span class="fu">aes</span><span class="op">(</span>size <span class="op">=</span> <span class="va">EGA</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">presence</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">year</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="04-Activity_3_files/figure-html/unnamed-chunk-3-1.png" width="672"></div>
</div>
<div id="data-split" class="section level2" number="5.6">
<h2>
<span class="header-section-number">5.6</span> Data Split<a class="anchor" aria-label="anchor" href="#data-split"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">df.sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">TRUE</span>,<span class="cn">FALSE</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, replace<span class="op">=</span><span class="cn">TRUE</span>, prob<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df.train</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">df.sample</span>,<span class="op">]</span></span>
<span><span class="va">df.test</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="op">!</span><span class="va">df.sample</span>,<span class="op">]</span></span></code></pre></div>
<div id="model-1" class="section level3" number="5.6.1">
<h3>
<span class="header-section-number">5.6.1</span> Model 1<a class="anchor" aria-label="anchor" href="#model-1"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu">gam</span><span class="op">(</span><span class="va">EGA</span> <span class="op">~</span> <span class="va">grass.perc</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">+</span> <span class="fu">s</span><span class="op">(</span><span class="va">long</span>,<span class="va">lat</span>, bs <span class="op">=</span> <span class="st">"gp"</span><span class="op">)</span>, </span>
<span>          family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">df.train</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Family: poisson </span></span>
<span><span class="co">#&gt; Link function: log </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula:</span></span>
<span><span class="co">#&gt; EGA ~ grass.perc + as.factor(year) + s(long, lat, bs = "gp")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parametric coefficients:</span></span>
<span><span class="co">#&gt;                      Estimate Std. Error z value Pr(&gt;|z|)</span></span>
<span><span class="co">#&gt; (Intercept)         -4.072721   0.508579  -8.008 1.17e-15</span></span>
<span><span class="co">#&gt; grass.perc          -0.034166   0.001664 -20.538  &lt; 2e-16</span></span>
<span><span class="co">#&gt; as.factor(year)2015  6.148542   0.500663  12.281  &lt; 2e-16</span></span>
<span><span class="co">#&gt;                        </span></span>
<span><span class="co">#&gt; (Intercept)         ***</span></span>
<span><span class="co">#&gt; grass.perc          ***</span></span>
<span><span class="co">#&gt; as.factor(year)2015 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  </span></span>
<span><span class="co">#&gt; 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Approximate significance of smooth terms:</span></span>
<span><span class="co">#&gt;               edf Ref.df Chi.sq p-value    </span></span>
<span><span class="co">#&gt; s(long,lat) 31.45   31.8   5663  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  </span></span>
<span><span class="co">#&gt; 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; R-sq.(adj) =   0.67   Deviance explained = 81.1%</span></span>
<span><span class="co">#&gt; UBRE = 17.558  Scale est. = 1         n = 178</span></span></code></pre></div>
</div>
<div id="model-2" class="section level3" number="5.6.2">
<h3>
<span class="header-section-number">5.6.2</span> Model 2<a class="anchor" aria-label="anchor" href="#model-2"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu">gam</span><span class="op">(</span><span class="va">EGA</span> <span class="op">~</span> <span class="va">grass.perc</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">+</span> <span class="fu">s</span><span class="op">(</span><span class="va">long</span>,<span class="va">lat</span>, bs <span class="op">=</span> <span class="st">"gp"</span><span class="op">)</span>, </span>
<span>          family <span class="op">=</span> <span class="fu">nb</span><span class="op">(</span>theta <span class="op">=</span> <span class="cn">NULL</span>,link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">df.train</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Family: Negative Binomial(0.653) </span></span>
<span><span class="co">#&gt; Link function: log </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula:</span></span>
<span><span class="co">#&gt; EGA ~ grass.perc + as.factor(year) + s(long, lat, bs = "gp")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parametric coefficients:</span></span>
<span><span class="co">#&gt;                     Estimate Std. Error z value Pr(&gt;|z|)</span></span>
<span><span class="co">#&gt; (Intercept)         -3.29390    0.61890  -5.322 1.03e-07</span></span>
<span><span class="co">#&gt; grass.perc          -0.00141    0.00678  -0.208    0.835</span></span>
<span><span class="co">#&gt; as.factor(year)2015  5.67995    0.59656   9.521  &lt; 2e-16</span></span>
<span><span class="co">#&gt;                        </span></span>
<span><span class="co">#&gt; (Intercept)         ***</span></span>
<span><span class="co">#&gt; grass.perc             </span></span>
<span><span class="co">#&gt; as.factor(year)2015 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  </span></span>
<span><span class="co">#&gt; 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Approximate significance of smooth terms:</span></span>
<span><span class="co">#&gt;               edf Ref.df Chi.sq p-value    </span></span>
<span><span class="co">#&gt; s(long,lat) 8.356  11.02  224.3  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  </span></span>
<span><span class="co">#&gt; 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; R-sq.(adj) =  0.263   Deviance explained = 72.7%</span></span>
<span><span class="co">#&gt; -REML = 493.04  Scale est. = 1         n = 178</span></span></code></pre></div>
</div>
<div id="model-3" class="section level3" number="5.6.3">
<h3>
<span class="header-section-number">5.6.3</span> Model 3<a class="anchor" aria-label="anchor" href="#model-3"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">m3</span> <span class="op">&lt;-</span> <span class="fu">gam</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">EGA</span> <span class="op">~</span> <span class="va">grass.perc</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">+</span> <span class="fu">s</span><span class="op">(</span><span class="va">long</span>,<span class="va">lat</span>, bs <span class="op">=</span> <span class="st">"gp"</span><span class="op">)</span>, <span class="op">~</span> <span class="va">grass.perc</span> <span class="op">+</span> <span class="fu">s</span><span class="op">(</span><span class="va">long</span>,<span class="va">lat</span>, bs <span class="op">=</span> <span class="st">"gp"</span><span class="op">)</span><span class="op">)</span>, </span>
<span>          family <span class="op">=</span> <span class="fu">ziplss</span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">df.train</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">m3</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Family: ziplss </span></span>
<span><span class="co">#&gt; Link function: identity identity </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula:</span></span>
<span><span class="co">#&gt; EGA ~ grass.perc + as.factor(year) + s(long, lat, bs = "gp")</span></span>
<span><span class="co">#&gt; ~grass.perc + s(long, lat, bs = "gp")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parametric coefficients:</span></span>
<span><span class="co">#&gt;                      Estimate Std. Error z value Pr(&gt;|z|)</span></span>
<span><span class="co">#&gt; (Intercept)         -3.561202   0.936080  -3.804 0.000142</span></span>
<span><span class="co">#&gt; grass.perc          -0.039519   0.001732 -22.811  &lt; 2e-16</span></span>
<span><span class="co">#&gt; as.factor(year)2015  5.546180   0.927371   5.981 2.22e-09</span></span>
<span><span class="co">#&gt; (Intercept).1       -0.038220   0.186544  -0.205 0.837661</span></span>
<span><span class="co">#&gt; grass.perc.1         0.001405   0.005252   0.267 0.789118</span></span>
<span><span class="co">#&gt;                        </span></span>
<span><span class="co">#&gt; (Intercept)         ***</span></span>
<span><span class="co">#&gt; grass.perc          ***</span></span>
<span><span class="co">#&gt; as.factor(year)2015 ***</span></span>
<span><span class="co">#&gt; (Intercept).1          </span></span>
<span><span class="co">#&gt; grass.perc.1           </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  </span></span>
<span><span class="co">#&gt; 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Approximate significance of smooth terms:</span></span>
<span><span class="co">#&gt;                  edf Ref.df  Chi.sq p-value    </span></span>
<span><span class="co">#&gt; s(long,lat)   30.937 31.330 4819.22 &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; s.1(long,lat)  2.828  3.463   16.34 0.00192 ** </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  </span></span>
<span><span class="co">#&gt; 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance explained = 78.1%</span></span>
<span><span class="co">#&gt; -REML = 1765.8  Scale est. = 1         n = 178</span></span></code></pre></div>
</div>
</div>
<div id="create-points-for-prediction" class="section level2" number="5.7">
<h2>
<span class="header-section-number">5.7</span> Create points for prediction<a class="anchor" aria-label="anchor" href="#create-points-for-prediction"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">####</span></span>
<span><span class="va">rl.E.y</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="op">(</span>,nrow<span class="op">=</span><span class="fl">30</span>,ncols<span class="op">=</span><span class="fl">30</span>,ext<span class="op">=</span><span class="fu">extent</span><span class="op">(</span><span class="va">ks</span><span class="op">)</span>,crs<span class="op">=</span><span class="fu">crs</span><span class="op">(</span><span class="va">ks</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">newPoints</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>long <span class="op">=</span> <span class="fu">xyFromCell</span><span class="op">(</span><span class="va">rl.E.y</span>,cell<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">rl.E.y</span><span class="op">[</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>                      lat <span class="op">=</span> <span class="fu">xyFromCell</span><span class="op">(</span><span class="va">rl.E.y</span>,cell<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">rl.E.y</span><span class="op">[</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">st_as_sf</span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'long'</span>, <span class="st">'lat'</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="va">ks</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">st_filter</span><span class="op">(</span><span class="va">ks</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">cross_join</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'2014'</span>, <span class="st">'2015'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">newPoints</span><span class="op">$</span><span class="va">lat</span> <span class="op">&lt;-</span> <span class="fu">st_coordinates</span><span class="op">(</span><span class="va">newPoints</span><span class="op">$</span><span class="va">geometry</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">newPoints</span><span class="op">$</span><span class="va">long</span> <span class="op">&lt;-</span> <span class="fu">st_coordinates</span><span class="op">(</span><span class="va">newPoints</span><span class="op">$</span><span class="va">geometry</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># </span></span>
<span><span class="co"># newPoints &lt;- st_sample(ks, size = 1000, type = "regular") %&gt;%</span></span>
<span><span class="co">#   as(., 'Spatial') %&gt;% as.data.frame() %&gt;%</span></span>
<span><span class="co">#     rename("long" = 'coords.x1',</span></span>
<span><span class="co">#          'lat' = 'coords.x2') %&gt;%</span></span>
<span><span class="co">#   cross_join(data.frame(year = as.factor(c('2014', '2015'))))</span></span>
<span></span>
<span>    </span>
<span><span class="va">pts.sample</span><span class="op">&lt;-</span> <span class="va">newPoints</span></span>
<span></span>
<span><span class="fu">coordinates</span><span class="op">(</span><span class="va">pts.sample</span><span class="op">)</span> <span class="op">=</span><span class="op">~</span> <span class="va">long</span> <span class="op">+</span> <span class="va">lat</span></span>
<span><span class="fu">proj4string</span><span class="op">(</span><span class="va">pts.sample</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">CRS</span><span class="op">(</span><span class="st">"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">newPoints</span><span class="op">$</span><span class="va">grass.perc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu">extract</span><span class="op">(</span><span class="va">rl.nlcd.grass</span>,<span class="va">pts.sample</span>,buffer<span class="op">=</span><span class="fl">5000</span><span class="op">)</span>,<span class="va">mean</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="fl">100</span></span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit mod 1</span></span>
<span><span class="va">newPoints</span><span class="op">$</span><span class="va">y_pred1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">m1</span>, <span class="va">newPoints</span>, type <span class="op">=</span> <span class="st">'response'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># m1.pred &lt;- st_as_sf(newPoints, coords = c('long', 'lat'), crs = st_crs(ks),</span></span>
<span><span class="co">#                     agr = 'constant') </span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span></span>
<span>  <span class="fu">geom_tile</span><span class="op">(</span>data <span class="op">=</span> <span class="va">newPoints</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, fill <span class="op">=</span> <span class="va">y_pred1</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">ks</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">'black'</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_c</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Longitude'</span>, y <span class="op">=</span> <span class="st">'Latitude'</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">30</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">year</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="04-Activity_3_files/figure-html/unnamed-chunk-9-1.png" width="672"></div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit mod 2</span></span>
<span><span class="va">newPoints</span><span class="op">$</span><span class="va">y_pred2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">m2</span>, <span class="va">newPoints</span>, type <span class="op">=</span> <span class="st">'response'</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span></span>
<span>  <span class="fu">geom_tile</span><span class="op">(</span>data <span class="op">=</span> <span class="va">newPoints</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, fill <span class="op">=</span> <span class="va">y_pred2</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">ks</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">'black'</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_c</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Longitude'</span>, y <span class="op">=</span> <span class="st">'Latitude'</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">30</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">year</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="04-Activity_3_files/figure-html/unnamed-chunk-10-1.png" width="672"></div>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit mod 3</span></span>
<span><span class="va">newPoints</span><span class="op">$</span><span class="va">y_pred3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">m3</span>, <span class="va">newPoints</span>, type <span class="op">=</span> <span class="st">'response'</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span></span>
<span>  <span class="fu">geom_tile</span><span class="op">(</span>data <span class="op">=</span> <span class="va">newPoints</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, fill <span class="op">=</span> <span class="va">y_pred3</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">ks</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">'black'</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_c</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Longitude'</span>, y <span class="op">=</span> <span class="st">'Latitude'</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">30</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">year</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="04-Activity_3_files/figure-html/unnamed-chunk-11-1.png" width="672"></div>
</div>
<div id="for-the-three-models-you-fit-in-question-3-which-model-makes-the-most-accurate-predictions-how-good-is-the-best-model-in-real-world-terms-remember-we-are-trying-to-predict-the-number-of-english-grain-aphids-which-is-a-count" class="section level2" number="5.8">
<h2>
<span class="header-section-number">5.8</span> For the three models you fit in question #3, which model makes the most accurate predictions? How good is the best model in real world terms? Remember we are trying to predict the number of English grain aphids, which is a count!<a class="anchor" aria-label="anchor" href="#for-the-three-models-you-fit-in-question-3-which-model-makes-the-most-accurate-predictions-how-good-is-the-best-model-in-real-world-terms-remember-we-are-trying-to-predict-the-number-of-english-grain-aphids-which-is-a-count"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rmse.m1</span> <span class="op">&lt;-</span> <span class="fu">rmse</span><span class="op">(</span><span class="va">df.test</span><span class="op">$</span><span class="va">EGA</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">m1</span>, <span class="va">df.test</span>, type <span class="op">=</span> <span class="st">'response'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mae.m1</span> <span class="op">&lt;-</span> <span class="fu">mae</span><span class="op">(</span><span class="va">df.test</span><span class="op">$</span><span class="va">EGA</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">m1</span>, <span class="va">df.test</span>, type <span class="op">=</span> <span class="st">'response'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rmse.m2</span> <span class="op">&lt;-</span> <span class="fu">rmse</span><span class="op">(</span><span class="va">df.test</span><span class="op">$</span><span class="va">EGA</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">m2</span>, <span class="va">df.test</span>, type <span class="op">=</span> <span class="st">'response'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mae.m2</span> <span class="op">&lt;-</span> <span class="fu">mae</span><span class="op">(</span><span class="va">df.test</span><span class="op">$</span><span class="va">EGA</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">m2</span>, <span class="va">df.test</span>, type <span class="op">=</span> <span class="st">'response'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rmse.m3</span> <span class="op">&lt;-</span> <span class="fu">rmse</span><span class="op">(</span><span class="va">df.test</span><span class="op">$</span><span class="va">EGA</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">m3</span>, <span class="va">df.test</span>, type <span class="op">=</span> <span class="st">'response'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mae.m3</span> <span class="op">&lt;-</span> <span class="fu">mae</span><span class="op">(</span><span class="va">df.test</span><span class="op">$</span><span class="va">EGA</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">m3</span>, <span class="va">df.test</span>, type <span class="op">=</span> <span class="st">'response'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#m1 metrics</span></span>
<span></span>
<span><span class="va">m1Metrics</span> <span class="op">&lt;-</span> <span class="va">df.test</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">m1</span>, <span class="va">df.test</span>, type <span class="op">=</span> <span class="st">'response'</span><span class="op">)</span>, <span class="va">EGA</span><span class="op">)</span>, </span>
<span>fill <span class="op">=</span> <span class="st">'purple4'</span>, color <span class="op">=</span> <span class="st">'black'</span>, shape <span class="op">=</span> <span class="fl">21</span>, size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>             alpha <span class="op">=</span> <span class="fl">.7</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_abline</span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1000</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1000</span>, <span class="fl">200</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1000</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1000</span>, <span class="fl">200</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">'m1'</span>, x <span class="op">=</span> <span class="st">'Predicted'</span>, y <span class="op">=</span> <span class="st">'Observed'</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span><span class="st">'text'</span>, label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'RMSE: '</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">rmse.m1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>, x <span class="op">=</span> <span class="fl">700</span>, y <span class="op">=</span> <span class="fl">200</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span><span class="st">'text'</span>, label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'MAE: '</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">mae.m1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>, x <span class="op">=</span> <span class="fl">700</span>, y <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        aspect.ratio <span class="op">=</span> <span class="fl">1</span>,</span>
<span>        text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span></span>
<span><span class="co">#m2 metrics</span></span>
<span></span>
<span><span class="va">m2Metrics</span> <span class="op">&lt;-</span> <span class="va">df.test</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">m2</span>, <span class="va">df.test</span>, type <span class="op">=</span> <span class="st">'response'</span><span class="op">)</span>, <span class="va">EGA</span><span class="op">)</span>, </span>
<span>             fill <span class="op">=</span> <span class="st">'purple4'</span>, color <span class="op">=</span> <span class="st">'black'</span>, shape <span class="op">=</span> <span class="fl">21</span>, size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>             alpha <span class="op">=</span> <span class="fl">.7</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_abline</span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1000</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1000</span>, <span class="fl">200</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1000</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1000</span>, <span class="fl">200</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">'m2'</span>, x <span class="op">=</span> <span class="st">'Predicted'</span>, y <span class="op">=</span> <span class="st">'Observed'</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span><span class="st">'text'</span>, label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'RMSE: '</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">rmse.m2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>, x <span class="op">=</span> <span class="fl">700</span>, y <span class="op">=</span> <span class="fl">200</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span><span class="st">'text'</span>, label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'MAE: '</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">mae.m2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>, x <span class="op">=</span> <span class="fl">700</span>, y <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        aspect.ratio <span class="op">=</span> <span class="fl">1</span>,</span>
<span>        text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span></span>
<span><span class="va">m3Metrics</span> <span class="op">&lt;-</span> <span class="va">df.test</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">m3</span>, <span class="va">df.test</span>, type <span class="op">=</span> <span class="st">'response'</span><span class="op">)</span>, <span class="va">EGA</span><span class="op">)</span>, </span>
<span>             fill <span class="op">=</span> <span class="st">'purple4'</span>, color <span class="op">=</span> <span class="st">'black'</span>, shape <span class="op">=</span> <span class="fl">21</span>, size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>             alpha <span class="op">=</span> <span class="fl">.7</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_abline</span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1000</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1000</span>, <span class="fl">200</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1000</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1000</span>, <span class="fl">200</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">'m3'</span>, x <span class="op">=</span> <span class="st">'Predicted'</span>, y <span class="op">=</span> <span class="st">'Observed'</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span><span class="st">'text'</span>, label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'RMSE: '</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">rmse.m3</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>, x <span class="op">=</span> <span class="fl">700</span>, y <span class="op">=</span> <span class="fl">200</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span><span class="st">'text'</span>, label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'MAE: '</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">mae.m3</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>, x <span class="op">=</span> <span class="fl">700</span>, y <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        aspect.ratio <span class="op">=</span> <span class="fl">1</span>,</span>
<span>        text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span></span>
<span><span class="fu">ggarrange</span><span class="op">(</span><span class="va">m1Metrics</span>,<span class="va">m2Metrics</span>, <span class="va">m3Metrics</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="04-Activity_3_files/figure-html/unnamed-chunk-12-1.png" width="1008"></div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">m1</span>, <span class="va">m2</span>, <span class="va">m3</span><span class="op">)</span></span>
<span><span class="co">#&gt;          df      AIC</span></span>
<span><span class="co">#&gt; m1 34.44604 3764.439</span></span>
<span><span class="co">#&gt; m2 14.12373  980.207</span></span>
<span><span class="co">#&gt; m3 39.79306 3313.507</span></span></code></pre></div>
</div>
<div id="summarize-your-results-using-words-numerical-values-and-figuresmaps." class="section level2" number="5.9">
<h2>
<span class="header-section-number">5.9</span> Summarize your results using words, numerical values and figures/maps.<a class="anchor" aria-label="anchor" href="#summarize-your-results-using-words-numerical-values-and-figuresmaps."><i class="fas fa-link"></i></a>
</h2>
<p>The three models were tested after splitting the data into testing and training through MAE and RMSE. In addition, AIC was compared. Both methods suggested that the model 2 was the best one. Below the predictions using the model 2 are presented for both years 2014 and 2015. The year 2014 resulted in very minimum abundance of EGA, while in 2015, the East region showed a high concentration of EGA.</p>
<div class="inline-figure"><img src="04-Activity_3_files/figure-html/unnamed-chunk-13-1.png" width="672"></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="activity-2.html"><span class="header-section-number">4</span> Activity 2</a></div>
<div class="empty"></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#activity-3"><span class="header-section-number">5</span> Activity 3</a></li>
<li><a class="nav-link" href="#upload-data"><span class="header-section-number">5.1</span> Upload data</a></li>
<li><a class="nav-link" href="#upload-covariates"><span class="header-section-number">5.2</span> Upload covariates</a></li>
<li><a class="nav-link" href="#for-the-data-on-the-abundance-of-english-grain-aphids-propose-three-different-statistical-models-or-machine-learning-approach-that-are-capable-of-predicting-the-number-of-english-grain-aphids-at-any-location-within-the-state-of-kansas-at-any-time-for-the-years-2014-and-2015.-make-sure-to-write-out-the-three-statistical-models-using-formal-notation-and-fully-describe-each-component-using-words."><span class="header-section-number">5.3</span> For the data on the abundance of English grain aphids, propose three different statistical models (or machine learning approach) that are capable of predicting the number of English grain aphids at any location within the state of Kansas at any time for the years 2014 and 2015. Make sure to write out the three statistical models using formal notation and fully describe each component using words.</a></li>
<li><a class="nav-link" href="#for-the-three-statistical-models-you-proposed-in-question-1-propose-a-way-to-measure-the-accuracy-and-perhaps-the-calibration-of-predictions."><span class="header-section-number">5.4</span> For the three statistical models you proposed in question #1, propose a way to measure the accuracy (and perhaps the calibration) of predictions.</a></li>
<li><a class="nav-link" href="#fit-the-three-statistical-models-you-proposed-in-question-1-to-the-english-grain-aphid-abundance-data."><span class="header-section-number">5.5</span> Fit the three statistical models you proposed in question #1 to the English grain aphid abundance data.</a></li>
<li>
<a class="nav-link" href="#data-split"><span class="header-section-number">5.6</span> Data Split</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#model-1"><span class="header-section-number">5.6.1</span> Model 1</a></li>
<li><a class="nav-link" href="#model-2"><span class="header-section-number">5.6.2</span> Model 2</a></li>
<li><a class="nav-link" href="#model-3"><span class="header-section-number">5.6.3</span> Model 3</a></li>
</ul>
</li>
<li><a class="nav-link" href="#create-points-for-prediction"><span class="header-section-number">5.7</span> Create points for prediction</a></li>
<li><a class="nav-link" href="#for-the-three-models-you-fit-in-question-3-which-model-makes-the-most-accurate-predictions-how-good-is-the-best-model-in-real-world-terms-remember-we-are-trying-to-predict-the-number-of-english-grain-aphids-which-is-a-count"><span class="header-section-number">5.8</span> For the three models you fit in question #3, which model makes the most accurate predictions? How good is the best model in real world terms? Remember we are trying to predict the number of English grain aphids, which is a count!</a></li>
<li><a class="nav-link" href="#summarize-your-results-using-words-numerical-values-and-figuresmaps."><span class="header-section-number">5.9</span> Summarize your results using words, numerical values and figures/maps.</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/rstudio/bookdown-demo/blob/master/04-Activity_3.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/rstudio/bookdown-demo/edit/master/04-Activity_3.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Portfolio Stat 764</strong>" was written by Gabriel Hintz. It was last built on 2024-05-09.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
